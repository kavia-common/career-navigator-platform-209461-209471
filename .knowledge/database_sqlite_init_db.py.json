{"is_source_file": true, "format": "Python", "description": "This script initializes and seeds an SQLite database for the Career Navigator Platform, defining schema, creating tables, inserting initial data from JSON files, and generating connection info files.", "external_files": ["seeds/sfia_skills.json", "seeds/roles.json", "seeds/learning_resources.json"], "external_methods": ["os.getenv", "os.path.exists", "json.load", "Path.mkdir", "Path.parent", "Path.resolve", "Path", "sqlite3.connect", "sqlite3.Connection.execute", "sqlite3.Cursor.execute", "sqlite3.Cursor.fetchone", "json.load"], "published": ["load_env", "ensure_dirs", "connect", "create_schema", "seed_from_json", "write_connection_info", "main"], "classes": [], "methods": [{"name": "load_env()", "description": "Loads environment variables, notably SQLITE_DB_PATH or defaults to 'myapp.db'.", "scope": "", "scopeKind": ""}, {"name": "ensure_dirs()", "description": "Ensures the existence of the seeds directory and database visualizer directory.", "scope": "", "scopeKind": ""}, {"name": "sqlite3.Connection connect(db_path: str)", "description": "Establishes a SQLite connection with foreign key support and journal mode set to WAL.", "scope": "", "scopeKind": ""}, {"name": "create_schema(conn: sqlite3.Connection)", "description": "Creates all necessary database tables, indexes, and constraints for the platform.", "scope": "", "scopeKind": ""}, {"name": "seed_from_json(conn: sqlite3.Connection)", "description": "Reads data from JSON seed files and upserts skills, roles, role requirements, learning resources, and resource mappings into the database.", "scope": "", "scopeKind": ""}, {"name": "write_connection_info(db_path: str)", "description": "Writes the database connection string and environment variable export to files for external usage.", "scope": "", "scopeKind": ""}, {"name": "main()", "description": "Main execution flow: loads environment, ensures directories, connects to database, creates schema, seeds data, and writes connection info.", "scope": "", "scopeKind": ""}, {"name": "_get_role_id(cur, name)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_get_skill_id(cur, code_or_name)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_upsert_resource(cur, res)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_upsert_resource_skill(cur, resource_id, skill_code_or_name, lv_min, lv_max)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_upsert_role(cur, role)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_upsert_role_skill_req(cur, role_id, skill_id, target_level, weight)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_upsert_skill(cur, skill)", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["load_env", "ensure_dirs", "connect", "create_schema", "seed_from_json", "write_connection_info"], "search-terms": ["init_db", "database_sqlite", "schema creation", "seeding JSON", "SQLite database setup", "Career Navigator Platform", "environment variable SQLITE_DB_PATH"], "state": 2, "file_id": 1, "knowledge_revision": 20, "git_revision": "41f915acbfba7f112b4b10e5cc064b4d43612f98", "revision_history": [{"17": "41f915acbfba7f112b4b10e5cc064b4d43612f98"}, {"20": "41f915acbfba7f112b4b10e5cc064b4d43612f98"}], "ctags": [{"_type": "tag", "name": "DEFAULT_DB", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^DEFAULT_DB = \"myapp.db\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "RESOURCES_FILE", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^RESOURCES_FILE = SEEDS_DIR \\/ \"learning_resources.json\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "ROLES_FILE", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^ROLES_FILE = SEEDS_DIR \\/ \"roles.json\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "SEEDS_DIR", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^SEEDS_DIR = Path(__file__).parent \\/ \"seeds\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "SKILLS_FILE", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^SKILLS_FILE = SEEDS_DIR \\/ \"sfia_skills.json\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_get_role_id", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^def _get_role_id(cur, name):$/", "language": "Python", "kind": "function", "signature": "(cur, name)"}, {"_type": "tag", "name": "_get_skill_id", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^def _get_skill_id(cur, code_or_name):$/", "language": "Python", "kind": "function", "signature": "(cur, code_or_name)"}, {"_type": "tag", "name": "_upsert_resource", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^def _upsert_resource(cur, res):$/", "language": "Python", "kind": "function", "signature": "(cur, res)"}, {"_type": "tag", "name": "_upsert_resource_skill", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^def _upsert_resource_skill(cur, resource_id, skill_code_or_name, lv_min, lv_max):$/", "language": "Python", "kind": "function", "signature": "(cur, resource_id, skill_code_or_name, lv_min, lv_max)"}, {"_type": "tag", "name": "_upsert_role", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^def _upsert_role(cur, role):$/", "language": "Python", "kind": "function", "signature": "(cur, role)"}, {"_type": "tag", "name": "_upsert_role_skill_req", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^def _upsert_role_skill_req(cur, role_id, skill_id, target_level, weight):$/", "language": "Python", "kind": "function", "signature": "(cur, role_id, skill_id, target_level, weight)"}, {"_type": "tag", "name": "_upsert_skill", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^def _upsert_skill(cur, skill):$/", "language": "Python", "kind": "function", "signature": "(cur, skill)"}, {"_type": "tag", "name": "connect", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^def connect(db_path: str) -> sqlite3.Connection:$/", "language": "Python", "typeref": "typename:sqlite3.Connection", "kind": "function", "signature": "(db_path: str)"}, {"_type": "tag", "name": "create_schema", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^def create_schema(conn: sqlite3.Connection):$/", "language": "Python", "kind": "function", "signature": "(conn: sqlite3.Connection)"}, {"_type": "tag", "name": "ensure_dirs", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^def ensure_dirs():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "load_env", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^def load_env():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "main", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^def main():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "seed_from_json", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^def seed_from_json(conn: sqlite3.Connection):$/", "language": "Python", "kind": "function", "signature": "(conn: sqlite3.Connection)"}, {"_type": "tag", "name": "write_connection_info", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^def write_connection_info(db_path: str):$/", "language": "Python", "kind": "function", "signature": "(db_path: str)"}], "hash": "19e8f264f366fb79adfa4fdcf5f5a73c", "format-version": 4, "code-base-name": "database_sqlite", "filename": "database_sqlite/init_db.py", "fields": [{"name": "DEFAULT_DB = \"myapp.db\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "RESOURCES_FILE = SEEDS_DIR \\/ \"learning_resources.json\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "ROLES_FILE = SEEDS_DIR \\/ \"roles.json\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "SEEDS_DIR = Path(__file__).parent \\/ \"seeds\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "SKILLS_FILE = SEEDS_DIR \\/ \"sfia_skills.json\"", "scope": "", "scopeKind": "", "description": "unavailable"}]}