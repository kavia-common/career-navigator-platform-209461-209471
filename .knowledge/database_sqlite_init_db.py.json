{"is_source_file": true, "format": "Python", "description": "This script initializes and seeds the SQLite database for the Career Navigator Platform. It sets up the schema with tables for skills, roles, requirements, user profiles, learning resources, career paths, and recommendations. It loads environment variables, creates necessary directories, establishes the database connection, creates tables with constraints and indexes, and seeds data from JSON files. It also writes connection info for external tools.", "external_files": ["json", "os", "sqlite3", "pathlib.Path", "contextlib.closing", "datetime"], "external_methods": ["json.load", "os.getenv", "os.path.exists", "Path.mkdir", "Path.parent", "Path.resolve", "sqlite3.connect", "sqlite3.Error", "sqlite3.Connection.execute", "sqlite3.Cursor.execute", "sqlite3.Cursor.fetchall", "sqlite3.Cursor.fetchone", "closing", "print"], "published": ["load_env", "ensure_dirs", "connect", "create_schema", "seed_from_json", "write_connection_info", "main"], "classes": [], "methods": [{"name": "load_env()", "description": "Loads environment variables needed by the script, specifically the database path.", "scope": "", "scopeKind": ""}, {"name": "ensure_dirs()", "description": "Ensures that seed and visualizer directories exist.", "scope": "", "scopeKind": ""}, {"name": "sqlite3.Connection connect(db_path: str)", "description": "Creates a SQLite database connection with foreign keys and journal mode enabled.", "scope": "", "scopeKind": ""}, {"name": "create_schema(conn: sqlite3.Connection)", "description": "Creates all required tables, constraints, indexes, and handles lightweight migrations for legacy databases.", "scope": "", "scopeKind": ""}, {"name": "seed_from_json(conn: sqlite3.Connection)", "description": "Seeds data into the database from JSON files for skills, roles, requirements, and learning resources.", "scope": "", "scopeKind": ""}, {"name": "write_connection_info(db_path: str)", "description": "Writes connection information files for external access and visualization.", "scope": "", "scopeKind": ""}, {"name": "main()", "description": "Main execution function that orchestrates database creation, seeding, and writing connection info.", "scope": "", "scopeKind": ""}, {"name": "_get_role_id(cur, name)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_get_skill_id(cur, code_or_name)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "bool _has_unique_on_learning_resources(cur)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_upsert_resource(cur, res)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_upsert_resource_skill(cur, resource_id, skill_code_or_name, lv_min, lv_max)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_upsert_role(cur, role)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_upsert_role_skill_req(cur, role_id, skill_id, target_level, weight)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_upsert_skill(cur, skill)", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["load_env", "ensure_dirs", "connect", "create_schema", "seed_from_json", "write_connection_info", "os.getenv", "Path.exists", "Path.mkdir", "Path.parent", "Path.resolve", "sqlite3.connect", "sqlite3.Connection.execute", "sqlite3.Cursor.execute", "json.load", "Path.open", "print"], "search-terms": ["init_db", "seeds", "schema", "database", "SQLite", "skills", "roles", "learning_resources", "requirements", "migration"], "state": 2, "file_id": 1, "knowledge_revision": 35, "git_revision": "71a410a99fa5dc787c77cc7cc8562881c7d72c5a", "revision_history": [{"17": "41f915acbfba7f112b4b10e5cc064b4d43612f98"}, {"20": "41f915acbfba7f112b4b10e5cc064b4d43612f98"}, {"30": "a45691320da4e418bad0c4246608069ad76dbd6b"}, {"31": "a45691320da4e418bad0c4246608069ad76dbd6b"}, {"32": "a45691320da4e418bad0c4246608069ad76dbd6b"}, {"33": "fc2e099022130f8755117592f52753e9b2c30709"}, {"35": "71a410a99fa5dc787c77cc7cc8562881c7d72c5a"}], "ctags": [{"_type": "tag", "name": "DEFAULT_DB", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^DEFAULT_DB = \"myapp.db\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "RESOURCES_FILE", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^RESOURCES_FILE = SEEDS_DIR \\/ \"learning_resources.json\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "ROLES_FILE", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^ROLES_FILE = SEEDS_DIR \\/ \"roles.json\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "SEEDS_DIR", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^SEEDS_DIR = Path(__file__).parent \\/ \"seeds\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "SKILLS_FILE", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^SKILLS_FILE = SEEDS_DIR \\/ \"sfia_skills.json\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_get_role_id", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^def _get_role_id(cur, name):$/", "language": "Python", "kind": "function", "signature": "(cur, name)"}, {"_type": "tag", "name": "_get_skill_id", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^def _get_skill_id(cur, code_or_name):$/", "language": "Python", "kind": "function", "signature": "(cur, code_or_name)"}, {"_type": "tag", "name": "_has_unique_on_learning_resources", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^def _has_unique_on_learning_resources(cur) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(cur)"}, {"_type": "tag", "name": "_upsert_resource", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^def _upsert_resource(cur, res):$/", "language": "Python", "kind": "function", "signature": "(cur, res)"}, {"_type": "tag", "name": "_upsert_resource_skill", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^def _upsert_resource_skill(cur, resource_id, skill_code_or_name, lv_min, lv_max):$/", "language": "Python", "kind": "function", "signature": "(cur, resource_id, skill_code_or_name, lv_min, lv_max)"}, {"_type": "tag", "name": "_upsert_role", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^def _upsert_role(cur, role):$/", "language": "Python", "kind": "function", "signature": "(cur, role)"}, {"_type": "tag", "name": "_upsert_role_skill_req", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^def _upsert_role_skill_req(cur, role_id, skill_id, target_level, weight):$/", "language": "Python", "kind": "function", "signature": "(cur, role_id, skill_id, target_level, weight)"}, {"_type": "tag", "name": "_upsert_skill", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^def _upsert_skill(cur, skill):$/", "language": "Python", "kind": "function", "signature": "(cur, skill)"}, {"_type": "tag", "name": "connect", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^def connect(db_path: str) -> sqlite3.Connection:$/", "language": "Python", "typeref": "typename:sqlite3.Connection", "kind": "function", "signature": "(db_path: str)"}, {"_type": "tag", "name": "create_schema", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^def create_schema(conn: sqlite3.Connection):$/", "language": "Python", "kind": "function", "signature": "(conn: sqlite3.Connection)"}, {"_type": "tag", "name": "ensure_dirs", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^def ensure_dirs():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "load_env", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^def load_env():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "main", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^def main():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "seed_from_json", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^def seed_from_json(conn: sqlite3.Connection):$/", "language": "Python", "kind": "function", "signature": "(conn: sqlite3.Connection)"}, {"_type": "tag", "name": "write_connection_info", "path": "/home/kavia/workspace/code-generation/career-navigator-platform-209461-209471/database_sqlite/init_db.py", "pattern": "/^def write_connection_info(db_path: str):$/", "language": "Python", "kind": "function", "signature": "(db_path: str)"}], "hash": "055738af9b30bfaa899f5f53391fc92a", "format-version": 4, "code-base-name": "database_sqlite", "filename": "database_sqlite/init_db.py", "fields": [{"name": "DEFAULT_DB = \"myapp.db\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "RESOURCES_FILE = SEEDS_DIR \\/ \"learning_resources.json\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "ROLES_FILE = SEEDS_DIR \\/ \"roles.json\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "SEEDS_DIR = Path(__file__).parent \\/ \"seeds\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "SKILLS_FILE = SEEDS_DIR \\/ \"sfia_skills.json\"", "scope": "", "scopeKind": "", "description": "unavailable"}]}